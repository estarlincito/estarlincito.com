#!/bin/sh

setup_repo() {
  echo "ğŸ”§ Setting up repo (submodules, auth)"
  sed -i "s|https://github.com/|https://${GITHUB_TOKEN}@github.com/|" .gitmodules
  git submodule sync
  git submodule update --init --recursive
 echo "âœ… Repo setup complete"
}


if [ "$VERCEL" = "1" ]; then
APP=$(node -p "require('./package.json').name")

if git diff HEAD^ HEAD --quiet -- "apps/$APP" || git diff HEAD^ HEAD --quiet -- "packages"; then
  echo "ğŸš€ Changes found in '$APP'. Starting deploy..."
  setup_repo
  exit 1
else
  echo "âš¡ No updates in '$APP'. Build skipped."
  exit 0
fi

else
  echo "â„¹ï¸ Not running on Vercel. Skipping repo setup."
fi




